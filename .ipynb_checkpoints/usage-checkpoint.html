<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Usage &mdash; TandemMod 1.1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=fc837d61"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            TandemMod
          </a>
              <div class="version">
                1.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_preprocessing.html">Data preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run_examples.html">Run examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data_postprocessing.html">Data postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help.html">Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing TandemMod</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">TandemMod</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/.ipynb_checkpoints/usage-checkpoint.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Link to this heading"></a></h1>
<section id="source-code">
<h2>Source code<a class="headerlink" href="#source-code" title="Link to this heading"></a></h2>
<p>The source code and data processing scripts are available on <a class="reference external" href="https://github.com/yulab2021/TandemMod">GitHub</a>. You can download them by using the git clone command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">yulab2021</span><span class="o">/</span><span class="n">TandemMod</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>TandemMod offers three modes: de novo training, transfer learning, and prediction. Researchers can train from scratch, fine-tune pre-trained models, or apply existing models for predictions. It provides a user-friendly solution for studying RNA modifications.</p>
<p>In the provided repository, the pretrained models are located under the <code class="docutils literal notranslate"><span class="pre">./models</span></code> directory, and the data processing scripts and the main script are located under the <code class="docutils literal notranslate"><span class="pre">./scripts</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── data
│   ├── A_test.tsv
│   ├── A_train.tsv
│   ├── m5C
│   ├── m6A
│   ├── m6A_test.tsv
│   └── m6A_train.tsv
├── demo
│   ├── fast5
│   │   └── batch_0.fast5
│   ├── files.txt
│   ├── guppy
│   │   ├── fail
│   │   │   └── fastq_runid_71d544d3bd9e1fe7886a5d176c756a576d30ed50_0_0.fastq
│   │   ├── guppy_basecaller_log-2023-06-06_09-58-28.log
│   │   ├── pass
│   │   │   └── fastq_runid_71d544d3bd9e1fe7886a5d176c756a576d30ed50_0_0.fastq
│   │   ├── sequencing_summary.txt
│   │   ├── sequencing_telemetry.js
│   │   └── workspace
│   │       └── batch_0.fast5
├── models
│   ├── hm5C_transfered_from_m5C.pkl
│   ├── m1A_train_on_rice_cDNA.pkl
│   ├── m5C_train_on_rice_cDNA.pkl
│   ├── m6A_train_on_rice_cDNA.pkl
│   ├── m7G_transfered_from_m5C.pkl
│   ├── psU_transfered_from_m5C.pkl
│   ├── test.model
│   └── test.pkl
├── plot
├── README.md
├── scripts
│   ├── extract_feature_from_signal.py
│   ├── extract_signal_from_fast5.py
│   ├── __init__.py
│   ├── models.py
│   ├── TandemMod.py
│   ├── train_test_split.py
│   ├── transcriptome_loci_to_genome_loci.py
│   └── utils.py
└── TandemMod.yaml
</pre></div>
</div>
</section>
<section id="training-from-scratch">
<h2>Training from scratch<a class="headerlink" href="#training-from-scratch" title="Link to this heading"></a></h2>
<p>The de novo training mode in TandemMod enables users to train the model from scratch using their own datasets. To train a TandemMod model, both modified and modification-free Direct RNA Sequencing (DRS) data are required.</p>
<p>Before training, the raw FAST5 files need to undergo the <a class="reference external" href="data_preprocessing">data processing procedure</a> . This process generates feature files specific to each modification type. The feature files should follow a naming convention that reflects the modification type they represent:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|--</span> <span class="n">data</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="n">A</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span>
<span class="o">|</span>   <span class="o">|--</span> <span class="n">m6A</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>In order to evaluate the performance during the training process, it is important to have a separate test dataset. Here’s a script that randomly splits the feature file into training and test sets:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">train_test_split</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">input_file</span> <span class="n">A</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">train_file</span> <span class="n">A_train</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">test_file</span> <span class="n">A_test</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">train_ratio</span> <span class="mf">0.8</span>
<span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">train_test_split</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">input_file</span> <span class="n">m6A</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">train_file</span> <span class="n">m6A_train</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">test_file</span> <span class="n">m6A_test</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> <span class="o">--</span><span class="n">train_ratio</span> <span class="mf">0.8</span>
</pre></div>
</div>
<p>To train the TandemMod model using labelled training dataset, you can set the <code class="docutils literal notranslate"><span class="pre">--run_mode</span></code> argument to “train”. This allows the model to be trained from scratch. Test data are required to evaluation the model performance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">TandemMod</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">run_mode</span> <span class="n">train</span> \
      <span class="o">--</span><span class="n">new_model</span> <span class="n">model</span><span class="o">/</span><span class="n">m6A</span><span class="o">.</span><span class="n">pkl</span> \
      <span class="o">--</span><span class="n">train_data_mod</span> <span class="n">data</span><span class="o">/</span><span class="n">m6A_train</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">train_data_unmod</span> <span class="n">data</span><span class="o">/</span><span class="n">A_train</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">test_data_mod</span> <span class="n">data</span><span class="o">/</span><span class="n">m6A_test</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">test_data_unmod</span> <span class="n">data</span><span class="o">/</span><span class="n">A_test</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">epoch</span> <span class="mi">100</span>
</pre></div>
</div>
<p>The training process can be stopped manually based on the performance on the test set or by setting the maximum number of epochs. You can monitor the performance of the model on the test set during training and decide when to stop based on your desired criteria, such as reaching a certain accuracy or loss threshold. Alternatively, you can set a specific number of epochs as the maximum value for training using the <code class="docutils literal notranslate"><span class="pre">-epoch</span></code> argument. This allows the model to train for a fixed number of iterations, regardless of the performance on the test set. After the specified number of epochs, the training process will automatically stop. By providing these options, you have the flexibility to control the training process based on your specific requirements and preferences. The training process should be something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Epoch</span> <span class="mi">2</span><span class="o">-</span><span class="mi">2</span> <span class="n">Train</span> <span class="n">acc</span><span class="p">:</span> <span class="mf">0.853227</span><span class="p">,</span> <span class="n">Test</span> <span class="n">Acc</span><span class="p">:</span> <span class="mf">0.801561</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.684026</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="o">-</span><span class="mi">3</span> <span class="n">Train</span> <span class="n">acc</span><span class="p">:</span> <span class="mf">0.857492</span><span class="p">,</span> <span class="n">Test</span> <span class="n">Acc</span><span class="p">:</span> <span class="mf">0.809284</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.689912</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="o">-</span><span class="mi">4</span> <span class="n">Train</span> <span class="n">acc</span><span class="p">:</span> <span class="mf">0.859884</span><span class="p">,</span> <span class="n">Test</span> <span class="n">Acc</span><span class="p">:</span> <span class="mf">0.810469</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.695631</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="o">-</span><span class="mi">5</span> <span class="n">Train</span> <span class="n">acc</span><span class="p">:</span> <span class="mf">0.863527</span><span class="p">,</span> <span class="n">Test</span> <span class="n">Acc</span><span class="p">:</span> <span class="mf">0.812851</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.701268</span>
<span class="n">Epoch</span> <span class="mi">2</span><span class="o">-</span><span class="mi">6</span> <span class="n">Train</span> <span class="n">acc</span><span class="p">:</span> <span class="mf">0.865912</span><span class="p">,</span> <span class="n">Test</span> <span class="n">Acc</span><span class="p">:</span> <span class="mf">0.814036</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.701268</span>
</pre></div>
</div>
</section>
<section id="transfer-learning">
<h2>Transfer learning<a class="headerlink" href="#transfer-learning" title="Link to this heading"></a></h2>
<p>In transfer learning mode, you can used a pretrained model to retrain the bottom layers to identify new modification. This mode leverages the knowledge acquired by the pretrained model on a large dataset and applies it to a specific target task with potentially limited data. To fine-tune the TandemMod model using other dataset, you can utilize the transfer run mode by setting the <code class="docutils literal notranslate"><span class="pre">--run_mode</span></code> argument to “transfer”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">TandemMod</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">run_mode</span> <span class="n">transfer</span> \
      <span class="o">--</span><span class="n">pretrained_model</span> <span class="n">model</span><span class="o">/</span><span class="n">m6A</span><span class="o">.</span><span class="n">pkl</span> \
      <span class="o">--</span><span class="n">new_model</span> <span class="n">model</span><span class="o">/</span><span class="n">m6Am</span><span class="o">.</span><span class="n">pkl</span>
      <span class="o">--</span><span class="n">train_data_mod</span> <span class="n">data</span><span class="o">/</span><span class="n">m6Am_train</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">train_data_unmod</span> <span class="n">data</span><span class="o">/</span><span class="n">A_train</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">test_data_mod</span> <span class="n">data</span><span class="o">/</span><span class="n">m6Am_test</span><span class="o">.</span><span class="n">tsv</span> \
      <span class="o">--</span><span class="n">test_data_unmod</span> <span class="n">data</span><span class="o">/</span><span class="n">A_test</span><span class="o">.</span><span class="n">tsv</span>  \
      <span class="o">--</span><span class="n">epoch</span> <span class="mi">100</span>
</pre></div>
</div>
</section>
<section id="prediction">
<h2>Prediction<a class="headerlink" href="#prediction" title="Link to this heading"></a></h2>
<p>Pretained models were saved in directory <code class="docutils literal notranslate"><span class="pre">./models</span></code>. You can load pretrained models to predict modification for new data by setting the <code class="docutils literal notranslate"><span class="pre">--run_mode</span></code> argument to “predict”. Before prediction, the raw FAST5 files need to undergo the <a class="reference external" href="data_preprocessing">data processing procedure</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">scripts</span><span class="o">/</span><span class="n">TandemMod</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">run_mode</span> <span class="n">predict</span> \
      <span class="o">--</span><span class="n">pretrained_model</span> <span class="n">model</span><span class="o">/</span><span class="n">m6A</span><span class="o">.</span><span class="n">pkl</span> \
      <span class="o">--</span><span class="n">feature_file</span> <span class="n">data</span><span class="o">/</span><span class="n">WT</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">tsv</span>
      <span class="o">--</span><span class="n">predict_result</span> <span class="n">data</span><span class="o">/</span><span class="n">WT</span><span class="o">.</span><span class="n">predict</span><span class="o">.</span><span class="n">tsv</span>
</pre></div>
</div>
<p>The prediction result “data/WT.predict.tsv” has the following format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transcript_id</span>           <span class="n">site</span>    <span class="n">motif</span>   <span class="n">read_id</span>                                 <span class="n">prediction</span>   <span class="n">probability</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">797</span>     <span class="n">AGATG</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">3.0628286e-07</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">807</span>     <span class="n">TGATA</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">m6A</span>          <span class="mf">0.7467682</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">809</span>     <span class="n">ATAGA</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.083823845</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">811</span>     <span class="n">AGAAC</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">9.587409e-07</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">812</span>     <span class="n">GAACC</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.00015656528</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">815</span>     <span class="n">CCATT</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.052929</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">823</span>     <span class="n">TGAAT</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.022003165</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">824</span>     <span class="n">GAATC</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.020237297</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">834</span>     <span class="n">TTAAT</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.015113605</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">835</span>     <span class="n">TAATG</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">4.8967524e-10</span>
<span class="n">LOC_Os06g45000</span><span class="mf">.1</span>        <span class="mi">838</span>     <span class="n">TGAGC</span>   <span class="n">d6d2430d</span><span class="o">-</span><span class="n">c1f4</span><span class="o">-</span><span class="mi">433</span><span class="n">b</span><span class="o">-</span><span class="mi">8</span><span class="n">cee</span><span class="o">-</span><span class="n">e44534baab1e</span>    <span class="n">A</span>            <span class="mf">0.0012183546</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Yulab.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>